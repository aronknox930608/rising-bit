format_version: 1.3.0
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
  - TEST_CONFIG_PTH: ./_tests/integration_tests/exit_code_tests/test-bitrise.yml

workflows:
  test:
    steps:
    - script:
        title: Run - Exit code test
        inputs:
        - content: |-
            #!/bin/bash

            echo "exit_code_test_fail"
            out=$($CURRENT_BITRISE run exit_code_test_fail -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 1 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"

            echo "exit_code_test_ok"
            out=$($CURRENT_BITRISE run exit_code_test_ok -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 0 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"

            echo "exit_code_test_sippable_fail"
            out=$($CURRENT_BITRISE run exit_code_test_sippable_fail -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 0 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"

            echo "exit_code_test_sippable_ok"
            out=$($CURRENT_BITRISE run exit_code_test_sippable_ok -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 0 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"
    - script:
        title: Trigger - Exit code test
        inputs:
        - content: |-
            #!/bin/bash

            echo "exit_code_test_fail"
            out=$($CURRENT_BITRISE trigger exit_code_test_fail -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 1 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"

            echo "exit_code_test_ok"
            out=$($CURRENT_BITRISE trigger exit_code_test_ok -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 0 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"

            echo "exit_code_test_sippable_fail"
            out=$($CURRENT_BITRISE trigger exit_code_test_sippable_fail -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 0 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"

            echo "exit_code_test_sippable_ok"
            out=$($CURRENT_BITRISE trigger exit_code_test_sippable_ok -c $TEST_CONFIG_PTH)
            status=$?
            echo "status: $status"
            if [ $status -ne 0 ] ; then
              echo "out: $out"
              exit 1
            fi
            echo "----------"